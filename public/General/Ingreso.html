<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ingreso - RPM Market</title>
  <link rel="icon" type="image/jpg" href="image/nuevo logo.jpeg"/>
  <link rel="stylesheet" href="registro.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>

</head>

<body>
  <div class="containerr">
    <form id="loginForm" class="form">
      <p id="heading"><i class="fa-solid fa-users"></i> Ingreso</p>
      <img src="IMAGENINGRESO/nuevo logo.jpeg" alt="Logo RPM">

      <div class="field">
        <i class="fa-regular fa-user"></i>
        <input autocomplete="off" id="user-name" name="username" placeholder="Usuario" class="input-field" type="text" required>
      </div>

      <div class="field">
        <i class="fa-solid fa-lock"></i>
        <input placeholder="ContraseÃ±a" id="input-pass" name="password" class="input-field" type="password" required>
      </div>

      <div class="btn">
        <button type="submit" id="btn" class="button1">Ingresar</button>
        <button type="button" class="button2" onclick="window.location.href='Registro.html'">Registro</button>
      </div>

      <button type="button" class="button3" onclick="window.location.href='RecuperarContraseÃ±a.html'">Â¿OlvidÃ³ su contraseÃ±a?</button>
      <p id="mensaje-error"></p>
      
      <hr style="margin: 15px 0; border: none; border-top: 1px solid #ccc;">
      
      <!-- ðŸ§ª MODO DEMO -->
      <p style="font-size: 12px; color: #999; margin: 10px 0;">ðŸ§ª Demo (sin BD):</p>
      <div class="btn" style="gap: 5px;">
        <button type="button" class="button1" style="font-size: 12px; padding: 8px;" onclick="loginDemo('usuario1', '123456')">Usuario Natural</button>
        <button type="button" class="button1" style="font-size: 12px; padding: 8px;" onclick="loginDemo('comerciante1', '123456')">Comerciante</button>
        <button type="button" class="button1" style="font-size: 12px; padding: 8px;" onclick="loginDemo('prestador1', '123456')">Prestador</button>
      </div>
    </form>

    <div style="text-align: center;">
      <button type="button" class="boton-rojo" onclick="window.location.href='index.html'">
        Ir al Centro de Compras
      </button>
    </div>
  </div>

  <script>
    // ðŸ§ª FunciÃ³n para login demo
    async function loginDemo(username, password) {
      const mensajeError = document.getElementById('mensaje-error');
      mensajeError.textContent = 'â³ Ingresando (modo demo)...';
      
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 5000);

        const response = await fetch('/api/login/demo', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password }),
          signal: controller.signal
        });

        clearTimeout(timeoutId);
        const data = await response.json();

        if (data.success) {
          localStorage.setItem("usuarioActivo", JSON.stringify({
            id: data.idUsuario,
            nombre: data.usuario,
            tipo: data.tipo
          }));

          if (data.tipo === 'Natural') {
            window.location.href = '/Natural/perfil_usuario.html';
          } else if (data.tipo === 'Comerciante') {
            window.location.href = '/Comerciante/perfil_comerciante.html';
          } else if (data.tipo === 'PrestadorServicio') {
            window.location.href = '/PrestadorServicios/perfil_servicios.html';
          } else {
            window.location.href = '/General/index.html';
          }
        } else {
          mensajeError.textContent = data.error || 'Error en login demo';
        }
      } catch (error) {
        console.error('Error:', error);
        mensajeError.textContent = 'Error al conectar';
      }
    }
  </script>

  <script src="../JS/app.js"></script>
</body>
</html>
